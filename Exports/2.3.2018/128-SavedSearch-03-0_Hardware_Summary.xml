<?xml version="1.0" encoding="utf-8"?>
<CustomReports>
  <Report ID="128" Exclude="" Action="add" FolderID="">
    <SearchName>03-0 Hardware Summary</SearchName>
    <Description>Monthly Hardware Summary report. Hardware by Device with hardware attributes including: device name, operating system, number of processors, manufacturer and last inventory scan date</Description>
    <FolderName>
    </FolderName>
    <SearchSQL><![CDATA[
-- Avoid locking by allowing result to contain uncommitted rows
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

-- Set the language to us_english so the datetime is consistent
SET LANGUAGE us_english

-- Split search words
DECLARE @SearchWholeWord nvarchar(max)
SET     @SearchWholeWord = @SearchText
DECLARE @SearchWords table(Word nvarchar(400) PRIMARY KEY)
DECLARE @SearchWordCount int
IF      (@SearchText IS NOT NULL AND @SearchText <> '')
BEGIN
        INSERT  @SearchWords SELECT DISTINCT * FROM TableSplitSearchWords(@SearchWholeWord)
END
SELECT  @SearchWordCount = COUNT(DISTINCT Word) FROM @SearchWords

-- Pre-calculate computers that user is allowed access
	CREATE TABLE #ComplianceComputerAllowed (ComplianceComputerID int PRIMARY KEY)
	INSERT  #ComplianceComputerAllowed SELECT * FROM TableComplianceComputerCurrentUser(NULL, NULL, NULL, NULL)

-- Limit rows returned if setting is present or provided row limit parameter not null
SET @RowLimit = dbo.MinRowLimit(@RowLimit, 'MaxCustomViewResultRows');
IF @RowLimit IS NULL OR @RowLimit = -1 BEGIN
    SET @RowLimit = 0x7FFFFFFF;
END
-- Custom view results query
SELECT  TOP(@RowLimit) results.*
FROM    (
                -- Custom view query for computers
                	SELECT  ComplianceComputer.ComplianceComputerID AS [ComputerID],
                        ComplianceComputer.ComputerName AS [ComputerName],
                        ComplianceComputer.Manufacturer AS [Manufacturer],
                        ComplianceComputer.ModelNo AS [ModelNo],
                        ComplianceComputerTypeI18N.DefaultValue AS [ComputerType],
                        ComputerChassisTypeI18N.DefaultValue AS [ChassisType],
                        ComplianceComputerStatusI18N.DefaultValue AS [ComputerStatus],
                        ComplianceComputer.SerialNo AS [SerialNo],
                        ComplianceComputer.NumberOfProcessors AS [NumberOfProcessors],
                        ComplianceComputer.NumberOfCores AS [NumberOfCores],
                        ComplianceComputer.ProcessorType AS [ProcessorType],
                        ComplianceComputer.MaxClockSpeed AS [MaxClockSpeed],
                        ComplianceComputer.IPAddress AS [IPAddress],
                        ComplianceComputer.MACAddress AS [MACAddress],
                        ComplianceComputer.TotalMemory AS [TotalMemory],
                        ComplianceComputer.TotalDiskSpace AS [TotalDiskSpace],
                        ComplianceComputer.OperatingSystem AS [OperatingSystem],
                        ComplianceComputer.ServicePack AS [ServicePack],
                        flatd.FlatName AS [FlatDomain],
                        cd.QualifiedName AS [Domain],
                        AssetComplianceStatusI18N.StatusDefaultValue AS [AssetComplianceStatus],
                        ComplianceComputer.InventoryDate AS [InventoryDate]
                	FROM    ComplianceComputer
                			-- Filter
                			INNER JOIN #ComplianceComputerAllowed AS filter ON filter.ComplianceComputerID = ComplianceComputer.ComplianceComputerID
                			-- Additional joins
                			LEFT OUTER JOIN dbo.ComplianceComputerTypeI18N ON ComplianceComputerTypeI18N.ComplianceComputerTypeID = ComplianceComputer.ComplianceComputerTypeID
                        LEFT OUTER JOIN ComputerChassisTypeI18n ON ComputerChassisTypeI18n.ChassisTypeID = ComplianceComputer.ChassisTypeID
                        LEFT OUTER JOIN dbo.ComplianceComputerStatusI18N ON ComplianceComputerStatusI18N.ComplianceComputerStatusID = ComplianceComputer.ComplianceComputerStatusID
                        LEFT OUTER JOIN dbo.ComplianceDomain AS flatd ON flatd.ComplianceDomainID = [ComplianceComputer].ComplianceDomainID
                        LEFT OUTER JOIN ComplianceDomain AS cd ON cd.ComplianceDomainID = ComplianceComputer.ComplianceDomainID
                        LEFT OUTER JOIN dbo.AssetComplianceStatusI18N ON AssetComplianceStatusI18N.AssetComplianceStatusID = ComplianceComputer.AssetComplianceStatusID
        ) AS results
WHERE   (@SearchWordCount = 0) OR
        (@SearchWordCount = (
                SELECT  COUNT(DISTINCT words.Word)
                FROM    @SearchWords AS words
                WHERE   ([ComputerName] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([Manufacturer] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([ModelNo] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([ComputerType] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([ChassisType] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([ComputerStatus] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([SerialNo] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([NumberOfProcessors] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([NumberOfCores] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([ProcessorType] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([MaxClockSpeed] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([IPAddress] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([MACAddress] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([TotalMemory] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([TotalDiskSpace] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([OperatingSystem] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([ServicePack] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([FlatDomain] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([Domain] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([AssetComplianceStatus] LIKE '%' + words.Word + '%' ESCAPE '\') OR
                        ([InventoryDate] LIKE '%' + words.Word + '%' ESCAPE '\')
        )) OPTION (RECOMPILE)
]]></SearchSQL>
  </Report>
</CustomReports>